<div class="container">
  <h1><%= @trip.name %></h1>

  <%# Passagens %>
  <h2><%= link_to 'Passagens', trip_tickets_path(@trip), class: 'text-decoration-none' %></h2>

  <% if @trip.tickets.present? %>
    <ul>
      <% @trip.tickets.order(:updated_at).take(2).each do |ticket| %>
        <li>
          <p>Passagem para: <%= ticket.destination %></p>
          <p>Saindo de: <%= ticket.origin %></p>
          <p>Duração: <%= "#{ticket.duration[:hours]}h" %><%= "#{ticket.duration[:minutes]}min" unless ticket.duration[:minutes].blank? %></p>
          <p>Preço pesquisado: <%= number_to_currency ticket.price, unit: 'R$ ', precision: 2, separator: ',', delimiter: '.' %></p>

          <p><%= link_to 'Visitar site', ticket.url, target: '_blank', class: 'btn btn-primary rounded-5' %></p>
        </li>
      <% end %>
    </ul>
  <% else %>
    <div>
      <p>Não há passagens adicionadas à sua viagem.</p>
      <%= link_to 'Nova passagem', new_trip_ticket_path(@trip), class: 'btn btn-primary rounded-5'  %>
    </div>
  <% end %>

  <%# Acomodações %>
  <h2><%= link_to 'Acomodações', trip_accommodations_path(@trip), class: 'text-decoration-none' %></h2>

  <% if @trip.accommodations.present? %>
    <ul>
      <% @trip.accommodations.order(:updated_at).take(2).each do |accommodation| %>
        <li>
          <h5><%= accommodation.name %></h5>
          <p>Espaço para <%= accommodation.capacity %> pessoas</p>
          <p>Tipo: <%= accommodation.category %></p>
          <p><%= link_to 'Visitar site', accommodation.url, target: '_blank', class: 'btn btn-primary rounded-5' %></p>
        </li>
      <% end %>
    </ul>
  <% else %>
    <div>
      <p>Não há acomodações adicionadas à sua viagem.</p>
      <%= link_to 'Nova acomodação', new_trip_accommodation_path(@trip), class: 'btn btn-primary rounded-5'  %>
    </div>
  <% end %>

  <%# Tasks %>
  <div class='my-3'>
    <h2>Tasks</h2>

    <%= simple_form_for [@trip, @task] do |f|%>
      <%= f.input :description, as: :string, class: 'form-control' %>
      <div class='input-group-append'>
        <%= f.submit 'Add task', class: 'btn btn-primary' %>
      </div>
    <% end %>

    <% if @trip.tasks %>
      <ul class="list-unstyled my-3">
        <% @trip.tasks.order(:done, :description).each do |task| %>
          <li>
            <div class="form-check" data-controller='task'>
              <input class="form-check-input" type="checkbox" name="done" id="<%= "task-#{task.id}" %>"
                    <%= "checked" if task.done? %>
                    data-action="click->task#toggleDone"
                    data-task-target="checkbox"
                    data-id="<%= task.id %>">
              <label data-task-target="label"
                     class="form-check-label"
                     for="<%= "task-#{task.id}" %>">
                     <% if task.done? %>
                      <s><%= task.description %></s>
                     <% else %>
                      <%= task.description %>
                     <% end %>
              </label>
              <%= link_to task_path(task), data: { turbo_method: :delete } do %>
                <i class="fa-solid fa-trash-can"></i>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
    <% else %>
    <% end %>
  </div>

  <h2>Detalhes da viagem</h2>
  <p>Destino: <%= @trip.destination %></p>
  <p>Início: <%= @trip.start_date %></p>
  <p>Fim: <%= @trip.end_date %></p>
</div>
